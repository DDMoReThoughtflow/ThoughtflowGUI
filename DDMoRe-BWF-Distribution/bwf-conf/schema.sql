DROP TABLE IF EXISTS project_access;
DROP TABLE IF EXISTS project_reviewer;
DROP TABLE IF EXISTS team;
DROP TABLE IF EXISTS authority;
DROP TABLE IF EXISTS project;
DROP TABLE IF EXISTS user;

CREATE CACHED TABLE IF NOT EXISTS user (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1) PRIMARY KEY,
	createdAt TIMESTAMP NOT NULL,
	modifiedAt TIMESTAMP NOT NULL,
   	username VARCHAR(128) NOT NULL,
   	password VARCHAR(128) NOT NULL,
   	firstname VARCHAR(128) NOT NULL,
   	lastname VARCHAR(128) NOT NULL,
   	email VARCHAR(128),
   	phone VARCHAR(128),
   	company VARCHAR(128),
   	location VARCHAR(128),
   	enabled BOOLEAN DEFAULT TRUE NOT NULL
);
ALTER TABLE user ADD CONSTRAINT idx_user_uk_username UNIQUE (username);

CREATE CACHED TABLE IF NOT EXISTS authority (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1) PRIMARY KEY,
   	role VARCHAR(128) NOT NULL,
   	idUser BIGINT NOT NULL,
   	FOREIGN KEY (idUser) REFERENCES user
);

CREATE CACHED TABLE IF NOT EXISTS project (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1) PRIMARY KEY,
	createdAt TIMESTAMP NOT NULL,
	modifiedAt TIMESTAMP NOT NULL,
   	name VARCHAR(128) NOT NULL,
   	gitUrl VARCHAR(128) NOT NULL,
   	priority VARCHAR(16) NOT NULL,
   	idOwner BIGINT NOT NULL,
   	FOREIGN KEY (idOwner) REFERENCES user
);
ALTER TABLE project ADD CONSTRAINT idx_project_uk_name UNIQUE (name);

CREATE CACHED TABLE IF NOT EXISTS project_access (
 	idUser BIGINT NOT NULL,	
 	idProject BIGINT NOT NULL,
 	FOREIGN KEY (idUser) REFERENCES user,
 	FOREIGN KEY (idProject) REFERENCES project
);

CREATE CACHED TABLE IF NOT EXISTS project_reviewer (
 	idUser BIGINT NOT NULL,	
 	idProject BIGINT NOT NULL,
 	FOREIGN KEY (idUser) REFERENCES user,
 	FOREIGN KEY (idProject) REFERENCES project
);

CREATE CACHED TABLE IF NOT EXISTS team (
 	idUser BIGINT NOT NULL,	
 	idMember BIGINT NOT NULL,
 	FOREIGN KEY (idUser) REFERENCES user,
 	FOREIGN KEY (idMember) REFERENCES user
);

